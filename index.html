<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#07090A">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <title>Tennis Scoreboard</title>
  
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    body, html { 
      margin: 0; padding: 0; 
      background-color: #07090A; 
      height: 100%; overflow: hidden; 
      overscroll-behavior: none;
    }
  </style>
</head>
<body>

<div id="root"></div>

<script type="text/babel">
  const { useState, useEffect, useCallback, useRef } = React;
  const PTS = ["0", "15", "30", "40"];

  /* ‚îÄ‚îÄ‚îÄ –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ ‚îÄ‚îÄ‚îÄ */
  
  // –ó–í–£–ö –û–¢–ö–õ–Æ–ß–ï–ù –ü–û –ü–†–û–°–¨–ë–ï
  function speak(text) {
    // –û—Å—Ç–∞–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é –ø—É—Å—Ç–æ–π, —á—Ç–æ–±—ã –Ω–µ –ª–æ–º–∞—Ç—å –ª–æ–≥–∏–∫—É –≤—ã–∑–æ–≤–æ–≤, –Ω–æ –∑–≤—É–∫ –Ω–µ –∏–¥–µ—Ç
    // console.log("Silent announcement:", text);
  }

  function vibrate(pattern = 25) {
    try { if (navigator.vibrate) navigator.vibrate(pattern); } catch (e) {}
  }

  function fmtTime(ms) {
    const s = Math.floor(ms / 1000);
    return `${Math.floor(s / 60)}:${(s % 60).toString().padStart(2, "0")}`;
  }

  /* ‚îÄ‚îÄ‚îÄ –õ–æ–≥–∏–∫–∞ –¢–µ–Ω–Ω–∏—Å–∞ ‚îÄ‚îÄ‚îÄ */
  function freshMatch(server) {
    return {
      p1: 0, p2: 0,        // –û—á–∫–∏ —Ç–µ–∫—É—â–µ–≥–æ –≥–µ–π–º–∞
      g1: 0, g2: 0,        // –ì–µ–π–º—ã
      s1: 0, s2: 0,        // –°–µ—Ç—ã
      sets: [],            // –ò—Å—Ç–æ—Ä–∏—è —Å–µ—Ç–æ–≤: [{a: 6, b: 4}, ...]
      total1: 0, total2: 0, // –û–ë–©–ï–ï –ö–û–õ–ò–ß–ï–°–¢–í–û –û–ß–ö–û–í
      tb: false, tb1: 0, tb2: 0,
      deuce: false, adv: false, advP: null,
      over: false, winner: null,
      server,
      pointNum: 0,
    };
  }

  function clone(o) { return JSON.parse(JSON.stringify(o)); }

  function winGame(s, p) {
    if (p === 1) s.g1++; else s.g2++;
    s.p1 = 0; s.p2 = 0;
    s.deuce = false; s.adv = false; s.advP = null;
    s.tb1 = 0; s.tb2 = 0; s.tb = false;
    s.server = s.server === 1 ? 2 : 1;
    
    if (s.g1 >= 6 && s.g1 - s.g2 >= 2) return winSet(s, 1);
    if (s.g2 >= 6 && s.g2 - s.g1 >= 2) return winSet(s, 2);
    if (s.g1 === 6 && s.g2 === 6) s.tb = true;
    return s;
  }

  function winSet(s, p) {
    s.sets.push({ a: s.g1, b: s.g2 });
    if (p === 1) s.s1++; else s.s2++;
    s.g1 = 0; s.g2 = 0;
    if (s.s1 >= 2) { s.over = true; s.winner = 1; }
    if (s.s2 >= 2) { s.over = true; s.winner = 2; }
    return s;
  }

  function point(prev, p) {
    const s = clone(prev);
    if (s.over) return s;
    s.pointNum++;
    
    // –°—á–∏—Ç–∞–µ–º –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—á–∫–æ–≤ (Total Points)
    if (p === 1) s.total1++; else s.total2++;

    // –¢–∞–π–±—Ä–µ–π–∫
    if (s.tb) {
      if (p === 1) s.tb1++; else s.tb2++;
      s.p1 = s.tb1; s.p2 = s.tb2;
      // –°–º–µ–Ω–∞ –ø–æ–¥–∞—á–∏ –Ω–∞ —Ç–∞–π–±—Ä–µ–π–∫–µ (–ø–æ—Å–ª–µ 1 –æ—á–∫–∞, –ø–æ—Ç–æ–º –∫–∞–∂–¥—ã–µ 2)
      if ((s.tb1 + s.tb2) % 2 === 1) s.server = s.server === 1 ? 2 : 1;
      
      if (s.tb1 >= 7 && s.tb1 - s.tb2 >= 2) return winGame(s, 1);
      if (s.tb2 >= 7 && s.tb2 - s.tb1 >= 2) return winGame(s, 2);
      return s;
    }

    // Deuce / Adv
    if (s.p1 >= 3 && s.p2 >= 3) {
      if (s.adv) {
        if (s.advP === p) return winGame(s, p);
        s.adv = false; s.advP = null; s.deuce = true;
        return s;
      }
      if (s.deuce || (s.p1 === 3 && s.p2 === 3)) {
        s.deuce = false; s.adv = true; s.advP = p;
        return s;
      }
    }

    // –û–±—ã—á–Ω—ã–π —Å—á–µ—Ç
    if (p === 1) s.p1++; else s.p2++;
    if (s.p1 >= 4 && s.p1 - s.p2 >= 2) return winGame(s, 1);
    if (s.p2 >= 4 && s.p2 - s.p1 >= 2) return winGame(s, 2);
    if (s.p1 >= 4) return winGame(s, 1);
    if (s.p2 >= 4) return winGame(s, 2);
    
    if (s.p1 === 3 && s.p2 === 3) s.deuce = true;
    return s;
  }

  function getPts(m, p) {
    if (m.tb) return p === 1 ? String(m.tb1) : String(m.tb2);
    if (m.deuce) return "40";
    if (m.adv) return m.advP === p ? "AD" : "40";
    const v = p === 1 ? m.p1 : m.p2;
    return PTS[v] || String(v);
  }

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–º–µ–Ω—ã —Å—Ç–æ—Ä–æ–Ω
  function checkSwitchSides(m) {
    if (m.over) return false;
    // –ù–∞ —Ç–∞–π–±—Ä–µ–π–∫–µ –º–µ–Ω—è–µ–º—Å—è –∫–∞–∂–¥—ã–µ 6 –æ—á–∫–æ–≤
    if (m.tb) {
      const sum = m.tb1 + m.tb2;
      return sum > 0 && sum % 6 === 0;
    }
    // –í –æ–±—ã—á–Ω–æ–º —Ä–µ–∂–∏–º–µ –º–µ–Ω—è–µ–º—Å—è, –µ—Å–ª–∏ —Å—É–º–º–∞ –≥–µ–π–º–æ–≤ –Ω–µ—á–µ—Ç–Ω–∞—è (1, 3, 5...)
    // –ò —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –∏–¥–µ—Ç –ø–∞—É–∑–∞ –º–µ–∂–¥—É –≥–µ–π–º–∞–º–∏ (–æ—á–∫–∏ 0-0)
    const gamesSum = m.g1 + m.g2;
    return gamesSum > 0 && gamesSum % 2 !== 0 && m.p1 === 0 && m.p2 === 0;
  }

  /* ‚îÄ‚îÄ‚îÄ Components ‚îÄ‚îÄ‚îÄ */

  function CoinToss({ p1, p2, onResult }) {
    const [phase, setPhase] = useState("idle");
    const [result, setResult] = useState(null);

    const toss = () => {
      vibrate(40);
      setPhase("spinning");
      const winner = Math.random() < 0.5 ? 1 : 2;
      setTimeout(() => {
        setResult(winner);
        setPhase("done");
        vibrate([20, 60, 20]);
      }, 1500);
    };

    return (
      <div style={{
        display: "flex", flexDirection: "column", alignItems: "center",
        justifyContent: "center", gap: 24, animation: "fadeUp 0.4s ease",
        padding: "0 20px", width: "100%", height: "100%"
      }}>
        <div style={{
          width: 120, height: 120, borderRadius: "50%",
          background: phase === "spinning"
            ? "conic-gradient(#C8FF00, #0a0f0a, #C8FF00, #0a0f0a, #C8FF00)"
            : result ? "linear-gradient(135deg, #C8FF00, #8BA600)" : "#1a1f1a",
          border: `3px solid ${result ? "#C8FF00" : "#333"}`,
          display: "flex", alignItems: "center", justifyContent: "center",
          animation: phase === "spinning" ? `spin 0.3s linear infinite` : "none",
        }} onClick={phase === "idle" ? toss : undefined}>
          <span style={{ fontSize: 36 }}>üéæ</span>
        </div>
        
        {phase === "done" && (
          <div style={{ textAlign: "center", marginTop: -10 }}>
            <p style={{color: "#C8FF00", fontWeight: "bold"}}>{result === 1 ? p1 : p2} serves!</p>
            <button onClick={() => onResult(result)} style={{
               marginTop: 20, padding: "12px 30px", background: "#333", 
               color: "#fff", borderRadius: 8, fontWeight: "bold"
            }}>Start Match</button>
          </div>
        )}
      </div>
    );
  }

  function TennisScoreboard() {
    const [screen, setScreen] = useState("setup");
    const [p1, setP1] = useState("Player 1");
    const [p2, setP2] = useState("Player 2");
    const [match, setMatch] = useState(null);
    const [hist, setHist] = useState([]);
    const [elapsed, setElapsed] = useState(0);
    const [flash, setFlash] = useState(null);
    const timerRef = useRef(null);
    const startRef = useRef(null);

    const startTimer = () => {
      startRef.current = Date.now();
      timerRef.current = setInterval(() => setElapsed(Date.now() - startRef.current), 1000);
    };
    const stopTimer = () => clearInterval(timerRef.current);

    const startMatch = (server) => {
      setMatch(freshMatch(server));
      setHist([]);
      setElapsed(0);
      setScreen("match");
      startTimer();
    };

    const doScore = useCallback((p) => {
      if (!match || match.over) return;
      vibrate(30);
      setHist(h => [...h, clone(match)]);
      const next = point(match, p);
      setMatch(next);
      setFlash(p);
      setTimeout(() => setFlash(null), 300);

      if (next.over) {
        setTimeout(() => { stopTimer(); setScreen("final"); }, 1500);
      }
    }, [match]);

    const doUndo = useCallback(() => {
      if (hist.length === 0) return;
      vibrate(20);
      setMatch(hist[hist.length - 1]);
      setHist(h => h.slice(0, -1));
    }, [hist]);

    const reset = () => { stopTimer(); setScreen("setup"); };

    const lime = "#C8FF00";
    const bg = "#07090A";
    
    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –Ω—É–∂–Ω–æ –ª–∏ –º–µ–Ω—è—Ç—å —Å—Ç–æ—Ä–æ–Ω—ã
    const showSwitch = match ? checkSwitchSides(match) : false;

    return (
      <div style={{
        fontFamily: "'Outfit', sans-serif",
        height: "100vh", background: bg, color: "white",
        display: "flex", flexDirection: "column", overflow: "hidden"
      }}>
        <style>{`
          @import url('https://fonts.googleapis.com/css2?family=DM+Mono:wght@400;500&family=Outfit:wght@400;600;700;800;900&display=swap');
          @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }
          @keyframes spin { to { transform: rotate(360deg); } }
          * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
          button { border: none; font-family: inherit; cursor: pointer; }
          input:focus { outline: none; border-color: ${lime} !important; }
        `}</style>

        {/* 1. SETUP SCREEN */}
        {screen === "setup" && (
          <div style={{ flex: 1, display: "flex", flexDirection: "column", alignItems: "center", justifyContent: "center", padding: 30 }}>
            <div style={{ fontSize: 40, marginBottom: 20 }}>üéæ</div>
            <h1 style={{ marginBottom: 40 }}>Tennis Score</h1>
            <input value={p1} onChange={e=>setP1(e.target.value)} placeholder="Player 1" style={{width: "100%", padding: 15, marginBottom: 15, borderRadius: 10, background: "#1a1a1a", border: "1px solid #333", color: "white"}} />
            <input value={p2} onChange={e=>setP2(e.target.value)} placeholder="Player 2" style={{width: "100%", padding: 15, marginBottom: 30, borderRadius: 10, background: "#1a1a1a", border: "1px solid #333", color: "white"}} />
            <button onClick={() => setScreen("toss")} style={{width: "100%", padding: 18, borderRadius: 12, background: lime, color: "black", fontWeight: 800, fontSize: 16}}>CONTINUE</button>
          </div>
        )}

        {/* 2. TOSS SCREEN */}
        {screen === "toss" && <CoinToss p1={p1} p2={p2} onResult={startMatch} />}

        {/* 3. MATCH SCREEN */}
        {screen === "match" && match && (
          <div style={{ flex: 1, display: "flex", flexDirection: "column" }}>
            {/* Top Bar */}
            <div style={{ padding: "15px", display: "flex", justifyContent: "space-between", color: "#666", fontSize: 13, fontFamily: "'DM Mono', monospace" }}>
              <span>{fmtTime(elapsed)}</span>
              <span>{match.tb ? "TIEBREAK" : `SET ${match.sets.length + 1}`}</span>
              <span>PTS: {match.pointNum}</span>
            </div>

            {/* SWITCH SIDES ALERT */}
            {showSwitch && (
              <div style={{
                background: lime, color: "black", textAlign: "center",
                padding: "8px", fontWeight: "900", letterSpacing: 1,
                animation: "blink 1s infinite", fontSize: 14
              }}>
                üîÅ CHANGE ENDS
              </div>
            )}

            {/* Scoreboard Area */}
            <div style={{ flex: 1, display: "flex", flexDirection: "column", justifyContent: "center", padding: 10 }}>
              
              {/* Sets History (Small) */}
              {match.sets.length > 0 && (
                 <div style={{display: "flex", justifyContent: "center", gap: 15, marginBottom: 10, fontSize: 14, fontFamily: "'DM Mono', monospace"}}>
                    {match.sets.map((s, i) => (
                      <span key={i} style={{color: "#888"}}>
                        <span style={{color: s.a > s.b ? lime : "#888"}}>{s.a}</span>-<span style={{color: s.b > s.a ? lime : "#888"}}>{s.b}</span>
                      </span>
                    ))}
                 </div>
              )}

              <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 10 }}>
                {[1, 2].map(pl => {
                   const isSrv = match.server === pl;
                   const pts = getPts(match, pl);
                   return (
                     <div key={pl} style={{
                       background: "#121415", borderRadius: 20, padding: 20,
                       textAlign: "center", position: "relative",
                       border: isSrv ? `1px solid ${lime}` : "1px solid #222"
                     }}>
                        {isSrv && <div style={{position:"absolute", top:10, right:10, width:8, height:8, background:lime, borderRadius:"50%"}} />}
                        <div style={{color: "#aaa", fontWeight: 700, fontSize: 14, marginBottom: 10, whiteSpace: "nowrap", overflow: "hidden", textOverflow: "ellipsis"}}>
                          {pl === 1 ? p1 : p2}
                        </div>
                        <div style={{fontSize: 24, fontWeight: 800, marginBottom: 10}}>
                          {pl === 1 ? match.g1 : match.g2} <span style={{fontSize: 10, color: "#444", fontWeight: 400}}>GAMES</span>
                        </div>
                        <div style={{fontSize: 70, fontWeight: 900, color: pts === "AD" ? lime : "white", lineHeight: 1}}>
                          {pts}
                        </div>
                     </div>
                   )
                })}
              </div>
            </div>

            {/* Controls */}
            <div style={{ padding: 20 }}>
               <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 10, marginBottom: 15 }}>
                  <button onClick={() => doScore(1)} style={{padding: 30, borderRadius: 16, background: "#1f2223", color: lime, fontSize: 18, fontWeight: 800, border: `1px solid ${lime}`}}>{p1}</button>
                  <button onClick={() => doScore(2)} style={{padding: 30, borderRadius: 16, background: "#1f2223", color: lime, fontSize: 18, fontWeight: 800, border: `1px solid ${lime}`}}>{p2}</button>
               </div>
               <div style={{display: "flex", gap: 10}}>
                 <button onClick={doUndo} disabled={hist.length===0} style={{flex: 1, padding: 15, borderRadius: 12, background: "#111", color: "#666", border: "1px solid #333"}}>Undo</button>
                 <button onClick={() => {stopTimer(); setScreen("final")}} style={{flex: 1, padding: 15, borderRadius: 12, background: "#111", color: "#666", border: "1px solid #333"}}>End</button>
               </div>
            </div>
          </div>
        )}

        {/* 4. FINAL RESULT SCREEN (FIXED) */}
        {screen === "final" && match && (
          <div style={{ flex: 1, display: "flex", flexDirection: "column", alignItems: "center", justifyContent: "center", padding: 20 }}>
             <div style={{fontSize: 60, marginBottom: 10}}>üèÜ</div>
             <h2 style={{color: lime, fontSize: 28, textTransform: "uppercase", marginBottom: 5}}>
               {match.winner ? (match.winner === 1 ? p1 : p2) + " Wins!" : "Finished"}
             </h2>
             <p style={{color: "#555", marginBottom: 30}}>{fmtTime(elapsed)} match duration</p>

             {/* –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Å—á–µ—Ç–∞ */}
             <div style={{ width: "100%", maxWidth: 350, background: "#121415", borderRadius: 16, padding: 20, marginBottom: 20 }}>
                {/* –ó–∞–≥–æ–ª–æ–≤–∫–∏ */}
                <div style={{ display: "grid", gridTemplateColumns: "1.5fr repeat(3, 1fr)", marginBottom: 15, borderBottom: "1px solid #222", paddingBottom: 10, fontSize: 12, color: "#555", fontFamily: "'DM Mono', monospace" }}>
                   <div style={{textAlign: "left"}}>PLAYER</div>
                   <div style={{textAlign: "center"}}>SET 1</div>
                   <div style={{textAlign: "center"}}>SET 2</div>
                   <div style={{textAlign: "center"}}>SET 3</div>
                </div>

                {/* –ò–≥—Ä–æ–∫ 1 */}
                <div style={{ display: "grid", gridTemplateColumns: "1.5fr repeat(3, 1fr)", marginBottom: 15, alignItems: "center" }}>
                   <div style={{fontWeight: 700, color: match.winner === 1 ? lime : "white", overflow:"hidden", textOverflow:"ellipsis", whiteSpace:"nowrap"}}>{p1}</div>
                   {/* –õ–æ–≥–∏–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–µ—Ç–æ–≤ + —Ç–µ–∫—É—â–µ–≥–æ –≥–µ–π–º–∞ –µ—Å–ª–∏ –º–∞—Ç—á –Ω–µ –æ–∫–æ–Ω—á–µ–Ω */}
                   {[0, 1, 2].map(i => {
                      const set = match.sets[i];
                      // –ï—Å–ª–∏ —Å–µ—Ç –±—ã–ª —Å—ã–≥—Ä–∞–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—á–µ—Ç. –ï—Å–ª–∏ –Ω–µ—Ç, –Ω–æ —ç—Ç–æ —Ç–µ–∫—É—â–∏–π —Å–µ—Ç - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≥–µ–π–º—ã. –ò–Ω–∞—á–µ –ø—Ä–æ—á–µ—Ä–∫.
                      let val = "-";
                      let color = "#333";
                      if (set) { val = set.a; color = set.a > set.b ? "white" : "#666"; }
                      else if (!match.over && match.sets.length === i) { val = match.g1; color = "#888"; }
                      return <div key={i} style={{textAlign: "center", fontWeight: 700, fontSize: 18, color: color}}>{val}</div>
                   })}
                </div>

                {/* –ò–≥—Ä–æ–∫ 2 */}
                <div style={{ display: "grid", gridTemplateColumns: "1.5fr repeat(3, 1fr)", alignItems: "center" }}>
                   <div style={{fontWeight: 700, color: match.winner === 2 ? lime : "white", overflow:"hidden", textOverflow:"ellipsis", whiteSpace:"nowrap"}}>{p2}</div>
                   {[0, 1, 2].map(i => {
                      const set = match.sets[i];
                      let val = "-";
                      let color = "#333";
                      if (set) { val = set.b; color = set.b > set.a ? "white" : "#666"; }
                      else if (!match.over && match.sets.length === i) { val = match.g2; color = "#888"; }
                      return <div key={i} style={{textAlign: "center", fontWeight: 700, fontSize: 18, color: color}}>{val}</div>
                   })}
                </div>
             </div>

             {/* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ Total Points */}
             <div style={{ display: "flex", gap: 10, width: "100%", maxWidth: 350, marginBottom: 30 }}>
                <div style={{flex: 1, background: "#1a1a1a", padding: 15, borderRadius: 12, textAlign: "center"}}>
                   <div style={{fontSize: 10, color: "#555", marginBottom: 5}}>TOTAL POINTS</div>
                   <div style={{fontSize: 20, fontWeight: 700, color: match.total1 > match.total2 ? "white" : "#666"}}>{match.total1}</div>
                   <div style={{fontSize: 10, color: "#444", marginTop: 2}}>{p1}</div>
                </div>
                <div style={{flex: 1, background: "#1a1a1a", padding: 15, borderRadius: 12, textAlign: "center"}}>
                   <div style={{fontSize: 10, color: "#555", marginBottom: 5}}>TOTAL POINTS</div>
                   <div style={{fontSize: 20, fontWeight: 700, color: match.total2 > match.total1 ? "white" : "#666"}}>{match.total2}</div>
                   <div style={{fontSize: 10, color: "#444", marginTop: 2}}>{p2}</div>
                </div>
             </div>

             <button onClick={reset} style={{ width: "100%", maxWidth: 350, padding: 18, borderRadius: 12, background: lime, color: "black", fontWeight: 800, fontSize: 16 }}>NEW MATCH</button>
          </div>
        )}

      </div>
    );
  }

  const root = ReactDOM.createRoot(document.getElementById("root"));
  root.render(<TennisScoreboard />);
</script>

</body>
</html>
